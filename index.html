<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Planeta Dorama ğŸŒ</title>

<style>
body { margin:0; font-family: Arial, sans-serif; background:#fff0f6; color:#333; }
header { background: linear-gradient(90deg, #ff7eb3, #b983ff); padding:20px; text-align:center; color:white; }
nav a { margin: 0 10px; color:white; text-decoration:none; font-weight:bold; }
section { padding:40px 20px; }
h2 { text-align:center; color:#b4005a; }

button{
  padding:14px 22px; margin:8px;
  background:#ff7eb3; color:white; border:none;
  border-radius:12px; cursor:pointer; font-weight:bold; font-size:18px;
}
button:hover{ background:#b983ff; }

.btn-pequeno{
  padding:10px 14px; font-size:14px; border-radius:10px; margin:6px;
}

/* Cards */
.cards{ display:flex; flex-wrap:wrap; gap:20px; justify-content:center; }
.card{
  background:white; width:300px; border-radius:18px; overflow:hidden;
  box-shadow:0 5px 15px rgba(0,0,0,0.1);
  transition: transform .3s ease, box-shadow .3s ease;
}
.card.click{ cursor:pointer; }
.card.click:hover{ transform: translateY(-8px); box-shadow:0 10px 25px rgba(0,0,0,0.15); }
.card img{ width:100%; height:380px; object-fit:cover; }
.card div{ padding:16px; }
.card h3{ margin:0 0 8px; }
.card p{ margin:0; color:#555; line-height:1.45; }
.card .mini{ margin-top:10px; font-weight:bold; color:#7a1b55; }

/* NotÃ­cias */
.grid-noticias{
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap:18px; max-width:980px; margin:0 auto;
}
.noticia{
  background:#fff; border-radius:16px; overflow:hidden;
  box-shadow:0 5px 15px rgba(0,0,0,0.08);
  display:flex; flex-direction:column;
}
.noticia .img{ width:100%; height:160px; object-fit:cover; background:#f6f6f6; }
.noticia .conteudo{ padding:16px; }
.noticia h3{ margin:0 0 8px; color:#b4005a; font-size:16px; line-height:1.25; }
.noticia p{ margin:0; color:#555; line-height:1.5; font-size:14px; }
.noticia .meta{ margin:8px 0 10px; font-size:13px; opacity:.85; }
.noticia a{ font-weight:bold; color:#b4005a; text-decoration:none; }
.noticia a:hover{ text-decoration:underline; }
.acoes-noticias{ text-align:center; margin-bottom:14px; }

.badge{
  display:inline-block;
  margin-top:10px;
  background: rgba(255,255,255,0.18);
  padding: 6px 10px;
  border-radius: 999px;
  font-size: 12px;
  font-weight: bold;
}

footer{ background:#b983ff; color:white; text-align:center; padding:15px; }
</style>
</head>

<body>

<header>
  <h1>ğŸŒğŸ¬ Planeta Dorama</h1>
  <p>Descubra doramas perfeitos para o seu momento ğŸ’–</p>

  <!-- ğŸ‘‡ isso serve pra vocÃª ter certeza que o index novo estÃ¡ no ar -->
  <div class="badge">âœ… VERSÃƒO PT-BR HOME (v3) â€” Planeta Dorama</div>

  <nav>
    <a href="#inicio">InÃ­cio</a>
    <a href="#listas">Listas ğŸ’–</a>
    <a href="#semana">Dorama da semana ğŸŒŸ</a>
    <a href="#noticias">NotÃ­cias ğŸ“°</a>
    <a href="todos.html">Todos os Doramas ğŸ“š</a>
    <a href="favoritos.html">ğŸ’œ Favoritos</a>
    <a href="descubra.html">Descubra ğŸ¤–</a>
  </nav>
</header>

<section id="inicio">
  <h2>âœ¨ Bem-vindo(a)</h2>
  <p style="text-align:center; max-width:700px; margin:auto;">
    O Planeta Dorama Ã© um espaÃ§o feito para quem ama histÃ³rias emocionantes,
    romÃ¢nticas, divertidas e intensas.
  </p>
</section>

<section id="listas">
  <h2>ğŸ“‹ Listas de Doramas</h2>
  <div style="text-align:center; margin-bottom:10px;">
    <button onclick="window.location.href='categoria.html?tipo=romance'">ğŸ’– RomÃ¢nticos</button>
    <button onclick="window.location.href='categoria.html?tipo=triste'">ğŸ˜­ Tristes</button>
    <button onclick="window.location.href='categoria.html?tipo=intenso'">ğŸ”¥ Intensos</button>
    <button onclick="window.location.href='categoria.html?tipo=alegre'">ğŸ˜Š Leves</button>
  </div>
  <p style="text-align:center; margin:0; opacity:0.85;">
    Clique e veja 10 doramas perfeitos pra cada emoÃ§Ã£o âœ¨
  </p>
</section>

<section id="semana">
  <h2>ğŸŒŸ Dorama da Semana</h2>
  <div class="cards" id="dorama-semana"></div>
  <p style="text-align:center; max-width:800px; margin: 14px auto 0; opacity:0.85;">
    Esse dorama muda automaticamente (aleatÃ³rio) quando a pÃ¡gina abre.
  </p>
</section>

<section id="noticias">
  <h2>ğŸ“° NotÃ­cias do Momento</h2>

  <div class="acoes-noticias">
    <button class="btn-pequeno" onclick="carregarNoticiasAutomaticas(true)">ğŸ”„ Atualizar notÃ­cias</button>
    <button class="btn-pequeno" onclick="window.location.href='noticias.html'">ğŸ“° Ver mais notÃ­cias</button>
  </div>

  <div class="grid-noticias" id="grid-noticias">
    <div class="noticia">
      <div class="conteudo">
        <h3>ğŸ“° Carregando notÃ­cias...</h3>
        <p>Aguarde alguns segundos âœ¨</p>
      </div>
    </div>
  </div>

  <p style="text-align:center; margin-top:14px; opacity:0.85;">
    NotÃ­cias automÃ¡ticas + traduÃ§Ã£o PT-BR âœ…
  </p>
</section>

<footer>
  <p>ğŸ’œ Planeta Dorama ğŸŒ â€” feito com amor</p>
</footer>

<script src="doramas.js"></script>
<script>
// =====================
// Dorama da Semana
// =====================
function carregarDoramaDaSemana() {
  const area = document.getElementById("dorama-semana");
  area.innerHTML = "";
  const escolhido = doramas[Math.floor(Math.random() * doramas.length)];
  area.innerHTML = `
    <div class="card click" onclick="window.location.href='dorama.html?nome=${encodeURIComponent(escolhido.nome)}'">
      <img src="${escolhido.imagem}" alt="${escolhido.nome}">
      <div>
        <h3>${escolhido.nome}</h3>
        <p>${(escolhido.descricao || "").replaceAll("\n","<br>")}</p>
        <div class="mini">â­ ${escolhido.nota || ""}</div>
      </div>
    </div>
  `;
}

// =====================
// NotÃ­cias + TraduÃ§Ã£o (com fallback)
// =====================
function limparHtml(texto) {
  return (texto || "").replace(/<[^>]*>?/gm, "").trim();
}

function formatarData(pubDate) {
  if (!pubDate) return "";
  const d = new Date(pubDate);
  if (isNaN(d.getTime())) return "";
  return d.toLocaleDateString("pt-BR", { day:"2-digit", month:"short", year:"numeric" });
}

function pegarImagemNoticia(item){
  if (item.thumbnail && item.thumbnail.startsWith("http")) return item.thumbnail;
  if (item.enclosure && item.enclosure.link && item.enclosure.link.startsWith("http")) return item.enclosure.link;
  const html = item.description || "";
  const match = html.match(/<img[^>]+src=["']([^"']+)["']/i);
  if (match && match[1] && match[1].startsWith("http")) return match[1];
  return "";
}

// Cache local (pra ficar rÃ¡pido)
const CACHE_KEY = "trad_cache_home_v3";
const tradCache = JSON.parse(localStorage.getItem(CACHE_KEY) || "{}");
function salvarCache(){ localStorage.setItem(CACHE_KEY, JSON.stringify(tradCache)); }

// 1) tenta LibreTranslate (POST)
// 2) se falhar, tenta MyMemory (GET)
// 3) se falhar, volta original
const LT_ENDPOINT = "https://translate.argosopentech.com/translate";

async function traduzirParaPT(texto) {
  const t = (texto || "").trim();
  if (!t) return "";
  const curto = t.slice(0, 240); // curto pra evitar erro/limite
  if (tradCache[curto]) return tradCache[curto];

  // TENTA 1: LibreTranslate
  try{
    const resp = await fetch(LT_ENDPOINT, {
      method: "POST",
      headers: { "Content-Type":"application/json" },
      body: JSON.stringify({ q: curto, source:"en", target:"pt", format:"text" })
    });
    if (resp.ok) {
      const data = await resp.json();
      const out = (data.translatedText || curto).trim();
      tradCache[curto] = out; salvarCache();
      return out;
    }
  } catch(e){}

  // TENTA 2: MyMemory
  try{
    const url = "https://api.mymemory.translated.net/get?q=" + encodeURIComponent(curto) + "&langpair=en|pt-BR";
    const resp2 = await fetch(url);
    const data2 = await resp2.json();
    const out2 = (data2.responseData && data2.responseData.translatedText) ? data2.responseData.translatedText.trim() : curto;
    tradCache[curto] = out2; salvarCache();
    return out2;
  } catch(e){}

  return curto;
}

async function carregarNoticiasAutomaticas(forcar=false) {
  const grid = document.getElementById("grid-noticias");

  grid.innerHTML = `
    <div class="noticia">
      <div class="conteudo">
        <h3>ğŸ“° Carregando notÃ­cias...</h3>
        <p>Aguarde alguns segundos âœ¨</p>
      </div>
    </div>
  `;

  try {
    const extra = forcar ? ("&cacheBust=" + Date.now()) : "";
    const feed = "https://blog.asianwiki.com/feed/";
    const url = "https://api.rss2json.com/v1/api.json?rss_url=" + encodeURIComponent(feed) + extra;

    const resp = await fetch(url);
    const data = await resp.json();

    if (!data.items || !Array.isArray(data.items)) throw new Error("Sem notÃ­cias");

    const top = data.items.slice(0, 6);

    // render rÃ¡pido (inglÃªs) + "Traduzindoâ€¦"
    grid.innerHTML = top.map((n, idx) => {
      const img = pegarImagemNoticia(n);
      const descLimpo = limparHtml(n.description);
      const descCurto = descLimpo.slice(0, 160) + (descLimpo.length > 160 ? "..." : "");
      return `
        <div class="noticia" id="home_news_${idx}">
          ${img ? `<img class="img" src="${img}" alt="NotÃ­cia">` : ``}
          <div class="conteudo">
            <h3 class="t">${n.title}</h3>
            <div class="meta">AsianWiki â€¢ ${formatarData(n.pubDate)}</div>
            <p class="d">${descCurto}</p>
            <p style="margin-top:10px;">
              <a href="${n.link}" target="_blank" rel="noopener noreferrer">Ler notÃ­cia original â†’</a>
            </p>
            <p class="trad" style="margin-top:10px; font-size:12px; opacity:0.75;">Traduzindoâ€¦</p>
          </div>
        </div>
      `;
    }).join("");

    // traduz por cima
    top.forEach((n, idx) => {
      (async () => {
        const card = document.getElementById(`home_news_${idx}`);
        if (!card) return;

        const descLimpo = limparHtml(n.description);
        const descCurto = descLimpo.slice(0, 160) + (descLimpo.length > 160 ? "..." : "");

        const tituloPT = await traduzirParaPT(n.title);
        const descPT   = await traduzirParaPT(descCurto);

        card.querySelector(".t").innerText = tituloPT;
        card.querySelector(".d").innerText = descPT;

        const p = card.querySelector(".trad");
        if (p) p.remove();
      })();
    });

  } catch (e) {
    grid.innerHTML = `
      <div class="noticia">
        <div class="conteudo">
          <h3>ğŸ˜¢ NÃ£o foi possÃ­vel carregar</h3>
          <p>Tente atualizar. Se persistir, pode ser limite do RSS2JSON ou da traduÃ§Ã£o.</p>
        </div>
      </div>
    `;
  }
}

window.onload = () => {
  carregarDoramaDaSemana();
  carregarNoticiasAutomaticas(false);
};
</script>

</body>
</html>
