<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Clube do Dorama ğŸ’•</title>

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #fff0f6;
    color: #333;
}
header {
    background: linear-gradient(90deg, #ff7eb3, #b983ff);
    padding: 20px;
    text-align: center;
    color: white;
}
nav a {
    margin: 0 10px;
    color: white;
    text-decoration: none;
    font-weight: bold;
}
section {
    padding: 40px 20px;
}
h2 {
    text-align: center;
    color: #b4005a;
}

/* BotÃµes maiores e bonitos */
button {
    padding: 14px 22px;
    margin: 8px;
    background:#ff7eb3;
    color:white;
    border:none;
    border-radius:12px;
    cursor:pointer;
    font-weight:bold;
    font-size:18px;
}
button:hover {
    background:#b983ff;
}

/* Cards */
.cards {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    justify-content: center;
}
.card {
    background: white;
    width: 300px;
    border-radius: 18px;
    overflow: hidden;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.card.click {
    cursor: pointer;
}
.card.click:hover {
    transform: translateY(-8px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.15);
}
.card img {
    width: 100%;
    height: 380px;
    object-fit: cover;
}
.card div {
    padding: 16px;
}
.card h3{
    margin: 0 0 8px;
}
.card p{
    margin: 0;
    color: #555;
    line-height: 1.45;
}
.card .mini{
    margin-top: 10px;
    font-weight: bold;
    color: #7a1b55;
}

/* NotÃ­cias */
.grid-noticias{
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 18px;
    max-width: 980px;
    margin: 0 auto;
}
.noticia{
    background: #fff;
    border-radius: 16px;
    padding: 16px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
}
.noticia h3{
    margin: 0 0 8px;
    color: #b4005a;
}
.noticia p{
    margin: 0;
    color: #555;
    line-height: 1.5;
}
.noticia a{
    font-weight:bold;
    color:#b4005a;
    text-decoration:none;
}
.noticia a:hover{
    text-decoration: underline;
}

footer {
    background: #b983ff;
    color: white;
    text-align: center;
    padding: 15px;
}
</style>
</head>

<body>

<header>
    <h1>ğŸ¬ Clube do Dorama</h1>
    <p>Descubra doramas perfeitos para o seu momento ğŸ’•</p>
    <nav>
        <a href="#inicio">InÃ­cio</a>
        <a href="#listas">Listas ğŸ’–</a>
        <a href="#semana">Dorama da semana ğŸŒŸ</a>
        <a href="#noticias">NotÃ­cias ğŸ“°</a>
        <a href="todos.html">Todos os Doramas ğŸ“š</a>
        <a href="descubra.html">Descubra ğŸ¤–</a>
    </nav>
</header>

<section id="inicio">
<h2>âœ¨ Bem-vindo(a)</h2>
<p style="text-align:center; max-width:700px; margin:auto;">
O Clube do Dorama Ã© um espaÃ§o feito para quem ama histÃ³rias emocionantes,
romÃ¢nticas, divertidas e intensas.
</p>
</section>

<section id="listas">
<h2>ğŸ“‹ Listas de Doramas</h2>

<div style="text-align:center; margin-bottom:10px;">
  <button onclick="window.location.href='categoria.html?tipo=romance'">ğŸ’– RomÃ¢nticos</button>
  <button onclick="window.location.href='categoria.html?tipo=triste'">ğŸ˜­ Tristes</button>
  <button onclick="window.location.href='categoria.html?tipo=intenso'">ğŸ”¥ Intensos</button>
  <button onclick="window.location.href='categoria.html?tipo=alegre'">ğŸ˜Š Leves</button>
</div>

<p style="text-align:center; margin:0; opacity:0.85;">
Clique e veja 10 doramas perfeitos pra cada emoÃ§Ã£o âœ¨
</p>
</section>

<section id="semana">
<h2>ğŸŒŸ Dorama da Semana</h2>

<div class="cards" id="dorama-semana"></div>

<p style="text-align:center; max-width:800px; margin: 14px auto 0; opacity:0.85;">
Esse dorama muda automaticamente (aleatÃ³rio) quando a pÃ¡gina abre.
</p>
</section>

<section id="noticias">
<h2>ğŸ“° NotÃ­cias do Momento</h2>

<div class="grid-noticias" id="grid-noticias">
  <div class="noticia">
    <h3>ğŸ“° Carregando notÃ­cias...</h3>
    <p>Aguarde alguns segundos âœ¨</p>
  </div>
</div>

<p style="text-align:center; margin-top:14px; opacity:0.85;">
As notÃ­cias sÃ£o carregadas automaticamente quando vocÃª abre a pÃ¡gina.
</p>
</section>

<footer>
<p>ğŸ’œ Clube do Dorama â€” feito com amor</p>
</footer>

<script src="doramas.js"></script>
<script>
// Dorama da Semana (automÃ¡tico)
function carregarDoramaDaSemana() {
  const area = document.getElementById("dorama-semana");
  area.innerHTML = "";

  const escolhido = doramas[Math.floor(Math.random() * doramas.length)];

  area.innerHTML = `
    <div class="card click" onclick="window.location.href='dorama.html?nome=${encodeURIComponent(escolhido.nome)}'">
      <img src="${escolhido.imagem}" alt="${escolhido.nome}">
      <div>
        <h3>${escolhido.nome}</h3>
        <p>${(escolhido.descricao || "").replaceAll("\n","<br>")}</p>
        <div class="mini">â­ ${escolhido.nota || ""}</div>
      </div>
    </div>
  `;
}

// ==== NOTÃCIAS AUTOMÃTICAS (RSS) ====

async function lerRss(feedUrl) {
  // Proxy para evitar bloqueio CORS em site estÃ¡tico (GitHub Pages)
  const proxy = "https://api.allorigins.win/raw?url=" + encodeURIComponent(feedUrl);

  const resp = await fetch(proxy);
  const xmlText = await resp.text();

  const parser = new DOMParser();
  const xml = parser.parseFromString(xmlText, "text/xml");

  const items = [...xml.querySelectorAll("item")].slice(0, 6).map(item => {
    const title = item.querySelector("title")?.textContent?.trim() || "Sem tÃ­tulo";
    const link = item.querySelector("link")?.textContent?.trim() || "#";
    const pubDate = item.querySelector("pubDate")?.textContent?.trim() || "";
    const descRaw = item.querySelector("description")?.textContent || "";
    const desc = descRaw.replace(/<[^>]*>/g, "").trim();

    return { title, link, pubDate, desc };
  });

  return items;
}

function formatarData(pubDate) {
  if (!pubDate) return "";
  const d = new Date(pubDate);
  if (isNaN(d.getTime())) return "";
  return d.toLocaleDateString("pt-BR", { day: "2-digit", month: "short", year: "numeric" });
}

async function carregarNoticiasAutomaticas() {
  const grid = document.getElementById("grid-noticias");

  const feeds = [
    { nome: "AsianWiki", url: "https://blog.asianwiki.com/feed/" },
    { nome: "Korea Times", url: "https://feed.koreatimes.co.kr/k/entertainment.xml" }
  ];

  try {
    const resultados = await Promise.allSettled(feeds.map(f => lerRss(f.url)));

    let noticias = [];
    resultados.forEach((r, idx) => {
      if (r.status === "fulfilled") {
        const fonte = feeds[idx].nome;
        r.value.forEach(n => noticias.push({ ...n, fonte }));
      }
    });

    if (noticias.length === 0) {
      grid.innerHTML = `
        <div class="noticia">
          <h3>ğŸ˜¢ NÃ£o foi possÃ­vel carregar</h3>
          <p>Algumas fontes podem bloquear o acesso. Tente atualizar a pÃ¡gina.</p>
        </div>
      `;
      return;
    }

    // Ordena por data
    noticias.sort((a, b) => new Date(b.pubDate) - new Date(a.pubDate));
    noticias = noticias.slice(0, 6);

    grid.innerHTML = noticias.map(n => `
      <div class="noticia">
        <h3>${n.title}</h3>
        <p style="margin:6px 0; font-size:13px; opacity:0.85;">
          ${n.fonte}${n.pubDate ? " â€¢ " + formatarData(n.pubDate) : ""}
        </p>
        <p>${(n.desc || "").slice(0, 160)}${(n.desc || "").length > 160 ? "..." : ""}</p>
        <p style="margin-top:10px;">
          <a href="${n.link}" target="_blank" rel="noopener noreferrer">Ler notÃ­cia â†’</a>
        </p>
      </div>
    `).join("");

  } catch (e) {
    grid.innerHTML = `
      <div class="noticia">
        <h3>ğŸ˜¢ Erro ao carregar</h3>
        <p>Atualize a pÃ¡gina e tente novamente.</p>
      </div>
    `;
  }
}

window.onload = () => {
  carregarDoramaDaSemana();
  carregarNoticiasAutomaticas();
};
</script>

</body>
</html>
