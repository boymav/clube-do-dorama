<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Clube do Dorama üíï</title>

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #fff0f6;
    color: #333;
}
header {
    background: linear-gradient(90deg, #ff7eb3, #b983ff);
    padding: 20px;
    text-align: center;
    color: white;
}
nav a {
    margin: 0 10px;
    color: white;
    text-decoration: none;
    font-weight: bold;
}
section {
    padding: 40px 20px;
}
h2 {
    text-align: center;
    color: #b4005a;
}

/* Bot√µes maiores e bonitos */
button {
    padding: 14px 22px;
    margin: 8px;
    background:#ff7eb3;
    color:white;
    border:none;
    border-radius:12px;
    cursor:pointer;
    font-weight:bold;
    font-size:18px;
}
button:hover {
    background:#b983ff;
}

/* Bot√µes menores (para a√ß√µes) */
.btn-pequeno{
    padding: 10px 14px;
    font-size: 14px;
    border-radius: 10px;
    margin: 6px;
}

/* Cards */
.cards {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    justify-content: center;
}
.card {
    background: white;
    width: 300px;
    border-radius: 18px;
    overflow: hidden;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.card.click {
    cursor: pointer;
}
.card.click:hover {
    transform: translateY(-8px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.15);
}
.card img {
    width: 100%;
    height: 380px;
    object-fit: cover;
}
.card div {
    padding: 16px;
}
.card h3{
    margin: 0 0 8px;
}
.card p{
    margin: 0;
    color: #555;
    line-height: 1.45;
}
.card .mini{
    margin-top: 10px;
    font-weight: bold;
    color: #7a1b55;
}

/* Not√≠cias */
.grid-noticias{
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 18px;
    max-width: 980px;
    margin: 0 auto;
}
.noticia{
    background: #fff;
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    display: flex;
    flex-direction: column;
}
.noticia .img{
    width: 100%;
    height: 160px;
    object-fit: cover;
    background: #f6f6f6;
}
.noticia .conteudo{
    padding: 16px;
}
.noticia h3{
    margin: 0 0 8px;
    color: #b4005a;
    font-size: 16px;
    line-height: 1.25;
}
.noticia p{
    margin: 0;
    color: #555;
    line-height: 1.5;
    font-size: 14px;
}
.noticia .meta{
    margin: 8px 0 10px;
    font-size: 13px;
    opacity: 0.85;
}
.noticia a{
    font-weight:bold;
    color:#b4005a;
    text-decoration:none;
}
.noticia a:hover{
    text-decoration: underline;
}

.acoes-noticias{
    text-align:center;
    margin-bottom: 14px;
}

footer {
    background: #b983ff;
    color: white;
    text-align: center;
    padding: 15px;
}
</style>
</head>

<body>

<header>
    <h1>üé¨ Clube do Dorama</h1>
    <p>Descubra doramas perfeitos para o seu momento üíï</p>
    <nav>
        <a href="#inicio">In√≠cio</a>
        <a href="#listas">Listas üíñ</a>
        <a href="#semana">Dorama da semana üåü</a>
        <a href="#noticias">Not√≠cias üì∞</a>
        <a href="todos.html">Todos os Doramas üìö</a>
        <a href="descubra.html">Descubra ü§ñ</a>
    </nav>
</header>

<section id="inicio">
<h2>‚ú® Bem-vindo(a)</h2>
<p style="text-align:center; max-width:700px; margin:auto;">
O Clube do Dorama √© um espa√ßo feito para quem ama hist√≥rias emocionantes,
rom√¢nticas, divertidas e intensas.
</p>
</section>

<section id="listas">
<h2>üìã Listas de Doramas</h2>

<div style="text-align:center; margin-bottom:10px;">
  <button onclick="window.location.href='categoria.html?tipo=romance'">üíñ Rom√¢nticos</button>
  <button onclick="window.location.href='categoria.html?tipo=triste'">üò≠ Tristes</button>
  <button onclick="window.location.href='categoria.html?tipo=intenso'">üî• Intensos</button>
  <button onclick="window.location.href='categoria.html?tipo=alegre'">üòä Leves</button>
</div>

<p style="text-align:center; margin:0; opacity:0.85;">
Clique e veja 10 doramas perfeitos pra cada emo√ß√£o ‚ú®
</p>
</section>

<section id="semana">
<h2>üåü Dorama da Semana</h2>

<div class="cards" id="dorama-semana"></div>

<p style="text-align:center; max-width:800px; margin: 14px auto 0; opacity:0.85;">
Esse dorama muda automaticamente (aleat√≥rio) quando a p√°gina abre.
</p>
</section>

<section id="noticias">
<h2>üì∞ Not√≠cias do Momento</h2>

<div class="acoes-noticias">
  <button class="btn-pequeno" onclick="carregarNoticiasAutomaticas(true)">üîÑ Atualizar not√≠cias</button>
  <button class="btn-pequeno" onclick="window.location.href='noticias.html'">üì∞ Ver mais not√≠cias</button>
</div>

<div class="grid-noticias" id="grid-noticias">
  <div class="noticia">
    <div class="conteudo">
      <h3>üì∞ Carregando not√≠cias...</h3>
      <p>Aguarde alguns segundos ‚ú®</p>
    </div>
  </div>
</div>

<p style="text-align:center; margin-top:14px; opacity:0.85;">
Not√≠cias autom√°ticas + tradu√ß√£o para PT-BR ‚úÖ
</p>
</section>

<footer>
<p>üíú Clube do Dorama ‚Äî feito com amor</p>
</footer>

<script src="doramas.js"></script>
<script>
// =====================
// Dorama da Semana
// =====================
function carregarDoramaDaSemana() {
  const area = document.getElementById("dorama-semana");
  area.innerHTML = "";

  const escolhido = doramas[Math.floor(Math.random() * doramas.length)];

  area.innerHTML = `
    <div class="card click" onclick="window.location.href='dorama.html?nome=${encodeURIComponent(escolhido.nome)}'">
      <img src="${escolhido.imagem}" alt="${escolhido.nome}">
      <div>
        <h3>${escolhido.nome}</h3>
        <p>${(escolhido.descricao || "").replaceAll("\n","<br>")}</p>
        <div class="mini">‚≠ê ${escolhido.nota || ""}</div>
      </div>
    </div>
  `;
}

// =====================
// Not√≠cias (RSS) + Tradu√ß√£o
// =====================
function limparHtml(texto) {
  return (texto || "").replace(/<[^>]*>?/gm, "").trim();
}

function formatarData(pubDate) {
  if (!pubDate) return "";
  const d = new Date(pubDate);
  if (isNaN(d.getTime())) return "";
  return d.toLocaleDateString("pt-BR", { day:"2-digit", month:"short", year:"numeric" });
}

function pegarImagemNoticia(item){
  if (item.thumbnail && item.thumbnail.startsWith("http")) return item.thumbnail;
  if (item.enclosure && item.enclosure.link && item.enclosure.link.startsWith("http")) return item.enclosure.link;
  const html = item.description || "";
  const match = html.match(/<img[^>]+src=["']([^"']+)["']/i);
  if (match && match[1] && match[1].startsWith("http")) return match[1];
  return "";
}

// Inst√¢ncia p√∫blica do LibreTranslate (pode trocar se alguma inst√¢ncia cair)
const LT_ENDPOINT = "https://translate.argosopentech.com/translate";

// Cache local para acelerar (n√£o traduzir tudo toda hora)
const CACHE_KEY = "trad_cache_home_v1";
const tradCache = JSON.parse(localStorage.getItem(CACHE_KEY) || "{}");

function salvarCache(){
  localStorage.setItem(CACHE_KEY, JSON.stringify(tradCache));
}

async function traduzirParaPT(texto) {
  const t = (texto || "").trim();
  if (!t) return "";

  // corta pra evitar erro e ficar r√°pido
  const curto = t.slice(0, 300);

  if (tradCache[curto]) return tradCache[curto];

  try{
    const resp = await fetch(LT_ENDPOINT, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        q: curto,
        source: "en",
        target: "pt",
        format: "text"
      })
    });

    if (!resp.ok) throw new Error("Falha tradu√ß√£o");

    const data = await resp.json();
    const traduzido = (data.translatedText || curto).trim();

    tradCache[curto] = traduzido;
    salvarCache();

    return traduzido;
  }catch{
    return curto; // se falhar, mant√©m original
  }
}

async function carregarNoticiasAutomaticas(forcar=false) {
  const grid = document.getElementById("grid-noticias");

  grid.innerHTML = `
    <div class="noticia">
      <div class="conteudo">
        <h3>üì∞ Carregando not√≠cias...</h3>
        <p>Aguarde alguns segundos ‚ú®</p>
      </div>
    </div>
  `;

  try {
    // RSS via rss2json (est√°vel em site est√°tico)
    const extra = forcar ? ("&cacheBust=" + Date.now()) : "";
    const feed = "https://blog.asianwiki.com/feed/";
    const url = "https://api.rss2json.com/v1/api.json?rss_url=" + encodeURIComponent(feed) + extra;

    const resp = await fetch(url);
    const data = await resp.json();

    if (!data.items || !Array.isArray(data.items)) {
      throw new Error("Sem not√≠cias");
    }

    const top = data.items.slice(0, 6);

    // 1) Render r√°pido (original)
    grid.innerHTML = top.map((n, idx) => {
      const img = pegarImagemNoticia(n);
      const descLimpo = limparHtml(n.description);
      const descCurto = descLimpo.slice(0, 170) + (descLimpo.length > 170 ? "..." : "");
      const cardId = `home_news_${idx}`;

      return `
        <div class="noticia" id="${cardId}">
          ${img ? `<img class="img" src="${img}" alt="Not√≠cia">` : ``}
          <div class="conteudo">
            <h3 class="t">${n.title}</h3>
            <div class="meta">AsianWiki ‚Ä¢ ${formatarData(n.pubDate)}</div>
            <p class="d">${descCurto}</p>
            <p style="margin-top:10px;">
              <a href="${n.link}" target="_blank" rel="noopener noreferrer">Ler not√≠cia original ‚Üí</a>
            </p>
            <p class="trad" style="margin-top:10px; font-size:12px; opacity:0.75;">Traduzindo‚Ä¶</p>
          </div>
        </div>
      `;
    }).join("");

    // 2) Traduz por cima (PT-BR)
    top.forEach((n, idx) => {
      (async () => {
        const card = document.getElementById(`home_news_${idx}`);
        if (!card) return;

        const descLimpo = limparHtml(n.description);
        const descCurto = descLimpo.slice(0, 170) + (descLimpo.length > 170 ? "..." : "");

        const tituloPT = await traduzirParaPT(n.title);
        const descPT = await traduzirParaPT(descCurto);

        card.querySelector(".t").innerText = tituloPT;
        card.querySelector(".d").innerText = descPT;

        const p = card.querySelector(".trad");
        if (p) p.remove();
      })();
    });

  } catch (e) {
    grid.innerHTML = `
      <div class="noticia">
        <div class="conteudo">
          <h3>üò¢ N√£o foi poss√≠vel carregar</h3>
          <p>Atualize a p√°gina e tente novamente.</p>
        </div>
      </div>
    `;
  }
}

window.onload = () => {
  carregarDoramaDaSemana();
  carregarNoticiasAutomaticas(false);
};
</script>

</body>
</html>
