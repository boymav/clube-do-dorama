<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Planeta Dorama üåç</title>

<meta name="description" content="Planeta Dorama üåç: listas, recomenda√ß√µes, dorama da semana, not√≠cias e um guia completo para voc√™ encontrar o dorama perfeito.">

<meta property="og:site_name" content="Planeta Dorama üåç">
<meta property="og:type" content="website">
<meta property="og:title" content="Planeta Dorama üåç">
<meta property="og:description" content="Listas, recomenda√ß√µes, dorama da semana e guia completo de doramas.">
<meta property="og:url" content="https://planetadorama.com.br/">
<meta property="og:image" content="https://planetadorama.com.br/imagens/og-capa.jpg">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Planeta Dorama üåç">
<meta name="twitter:description" content="Listas, recomenda√ß√µes e guia completo de doramas.">
<meta name="twitter:image" content="https://planetadorama.com.br/imagens/og-capa.jpg">

<style>
body { margin:0; font-family: Arial, sans-serif; background:#fff0f6; color:#333; }
header { background: linear-gradient(90deg, #ff7eb3, #b983ff); padding:20px; text-align:center; color:white; }
nav a { margin: 0 10px; color:white; text-decoration:none; font-weight:bold; }
section { padding:40px 20px; }
h2 { text-align:center; color:#b4005a; }

button{
  padding:14px 22px; margin:8px;
  background:#ff7eb3; color:white; border:none;
  border-radius:12px; cursor:pointer; font-weight:bold; font-size:18px;
}
button:hover{ background:#b983ff; }

.btn-pequeno{
  padding:10px 14px; font-size:14px; border-radius:10px; margin:6px;
}

/* Cards */
.cards{ display:flex; flex-wrap:wrap; gap:20px; justify-content:center; }
.card{
  background:white; width:300px; border-radius:18px; overflow:hidden;
  box-shadow:0 5px 15px rgba(0,0,0,0.1);
  transition: transform .3s ease, box-shadow .3s ease;
}
.card.click{ cursor:pointer; }
.card.click:hover{ transform: translateY(-8px); box-shadow:0 10px 25px rgba(0,0,0,0.15); }
.card img{ width:100%; height:380px; object-fit:cover; display:block; }
.card div{ padding:16px; }
.card h3{ margin:0 0 8px; }
.card p{ margin:0; color:#555; line-height:1.45; }
.card .mini{ margin-top:10px; font-weight:bold; color:#7a1b55; }

/* Cards menores (Top 5) */
.card.small{ width:220px; }
.card.small img{ height:280px; }
.card.small .mini{ margin-top:8px; }

/* Not√≠cias */
.grid-noticias{
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap:18px; max-width:980px; margin:0 auto;
}
.noticia{
  background:#fff; border-radius:16px; overflow:hidden;
  box-shadow:0 5px 15px rgba(0,0,0,0.08);
  display:flex; flex-direction:column;
}
.noticia .img{ width:100%; height:160px; object-fit:cover; background:#f6f6f6; }
.noticia .conteudo{ padding:16px; }
.noticia h3{ margin:0 0 8px; color:#b4005a; font-size:16px; line-height:1.25; }
.noticia p{ margin:0; color:#555; line-height:1.5; font-size:14px; }
.noticia .meta{ margin:8px 0 10px; font-size:13px; opacity:.85; }
.noticia a{ font-weight:bold; color:#b4005a; text-decoration:none; }
.noticia a:hover{ text-decoration:underline; }
.acoes-noticias{ text-align:center; margin-bottom:14px; }

.badge{
  display:inline-block;
  margin-top:10px;
  background: rgba(255,255,255,0.18);
  padding: 6px 10px;
  border-radius: 999px;
  font-size: 12px;
  font-weight: bold;
}

/* ===== BUSCA INTELIGENTE ===== */
.busca-wrap{
  max-width: 720px;
  margin: 16px auto 0;
  position: relative;
  text-align: left;
}

.busca-input{
  width: 100%;
  padding: 14px 16px;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,0.55);
  outline: none;
  font-size: 16px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.12);
}

.busca-input:focus{
  border-color: rgba(255,255,255,0.85);
  box-shadow: 0 10px 22px rgba(0,0,0,0.16);
}

.sugestoes{
  position: absolute;
  top: calc(100% + 8px);
  left: 0;
  right: 0;
  background: #fff;
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 12px 30px rgba(0,0,0,0.18);
  display: none;
  z-index: 50;
}

.sugestoes .item{
  display:flex;
  gap:12px;
  align-items:center;
  padding: 10px 12px;
  cursor: pointer;
}

.sugestoes .item:hover{
  background: #fff0f6;
}

.sugestoes img{
  width: 46px;
  height: 64px;
  object-fit: cover;
  border-radius: 10px;
  flex: 0 0 auto;
}

.sugestoes .nome{
  font-weight: bold;
  color: #333;
  margin-bottom: 4px;
}

.sugestoes .nota{
  font-size: 13px;
  opacity: 0.85;
  color:#7a1b55;
}

footer{ background:#b983ff; color:white; text-align:center; padding:15px; }
</style>
</head>

<body>

<header>
  <h1>üåçüé¨ Planeta Dorama</h1>
  <p>Descubra doramas perfeitos para o seu momento üíñ</p>

  <!-- Busca inteligente -->
  <div class="busca-wrap">
    <input id="buscaHome" class="busca-input" type="text" placeholder="üîé Buscar dorama... Ex: Goblin, Vincenzo, Reply 1988" autocomplete="off">
    <div id="sugestoes" class="sugestoes"></div>
  </div>

  <nav style="margin-top:16px;">
    <a href="#inicio">In√≠cio</a>
    <a href="#top5">Top 5 ‚≠ê</a>
    <a href="#listas">Listas üíñ</a>
    <a href="#semana">Dorama da semana üåü</a>
    <a href="#noticias">Not√≠cias üì∞</a>
    <a href="todos.html">Todos os Doramas üìö</a>
    <a href="favoritos.html">üíú Favoritos</a>
    <a href="descubra.html">Descubra ü§ñ</a>
  </nav>
</header>

<section id="inicio">
  <h2>‚ú® Bem-vindo(a)</h2>
  <p style="text-align:center; max-width:700px; margin:auto;">
    O <b>Planeta Dorama üåç</b> √© um espa√ßo feito para quem ama hist√≥rias emocionantes,
    rom√¢nticas, divertidas e intensas.
  </p>
</section>

<section id="top5">
  <h2>üèÜ Top 5 mais bem avaliados</h2>
  <div class="cards" id="top5-cards"></div>
</section>

<section id="listas">
  <h2>üìã Listas de Doramas</h2>
  <div style="text-align:center; margin-bottom:10px;">
    <button onclick="window.location.href='categoria.html?tipo=romance'">üíñ Rom√¢nticos</button>
    <button onclick="window.location.href='categoria.html?tipo=triste'">üò≠ Tristes</button>
    <button onclick="window.location.href='categoria.html?tipo=intenso'">üî• Intensos</button>
    <button onclick="window.location.href='categoria.html?tipo=alegre'">üòä Leves</button>
  </div>
  <p style="text-align:center; margin:0; opacity:0.85;">
    Clique e veja 10 doramas perfeitos pra cada emo√ß√£o ‚ú®
  </p>
</section>

<section id="semana">
  <h2>üåü Dorama da Semana</h2>
  <div class="cards" id="dorama-semana"></div>
  <p style="text-align:center; max-width:800px; margin: 14px auto 0; opacity:0.85;">
    Esse dorama muda automaticamente (aleat√≥rio) quando a p√°gina abre.
  </p>
</section>

<section id="noticias">
  <h2>üì∞ Not√≠cias do Momento</h2>

  <div class="acoes-noticias">
    <button class="btn-pequeno" onclick="carregarNoticiasAutomaticas(true)">üîÑ Atualizar not√≠cias</button>
    <button class="btn-pequeno" onclick="window.location.href='noticias.html'">üì∞ Ver mais not√≠cias</button>
  </div>

  <div class="grid-noticias" id="grid-noticias">
    <div class="noticia">
      <div class="conteudo">
        <h3>üì∞ Carregando not√≠cias...</h3>
        <p>Aguarde alguns segundos ‚ú®</p>
      </div>
    </div>
  </div>
</section>

<footer>
  <p>üíú Planeta Dorama üåç ‚Äî feito com amor</p>
  <p>
    <a href="politica.html">Pol√≠tica de Privacidade</a> |
    <a href="termos.html">Termos de Uso</a> |
    <a href="contato.html">Contato</a>
  </p>
</footer>

<script src="doramas.js"></script>
<script>
// ===== MELHORIA: SLUG PARA URL SEO =====
function criarSlug(nome){
  return String(nome || "")
    .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
    .toLowerCase()
    .replace(/[^a-z0-9]+/g, "-")
    .replace(/(^-|-$)/g, "");
}

// Helpers
function parseNota(nota){
  const m = String(nota || "").match(/[\d]+([.,]\d+)?/);
  if(!m) return 0;
  return parseFloat(m[0].replace(",", "."));
}

// Top 5
function carregarTop5(){
  const area = document.getElementById("top5-cards");
  if(!area || !Array.isArray(doramas)) return;

  const top = [...doramas]
    .map(d => ({...d, _notaNum: parseNota(d.nota)}))
    .sort((a,b) => b._notaNum - a._notaNum)
    .slice(0, 5);

  area.innerHTML = top.map(d => `
    <div class="card click small" onclick="window.location.href='/doramas/${criarSlug(d.nome)}.html'">
      <img src="${d.imagem}" alt="${d.nome}" loading="lazy">
      <div>
        <h3>${d.nome}</h3>
        <div class="mini">‚≠ê ${d.nota || ""}</div>
      </div>
    </div>
  `).join("");
}

// Dorama da Semana
function carregarDoramaDaSemana() {
  const area = document.getElementById("dorama-semana");
  area.innerHTML = "";
  const escolhido = doramas[Math.floor(Math.random() * doramas.length)];
  area.innerHTML = `
    <div class="card click" onclick="window.location.href='/doramas/${criarSlug(escolhido.nome)}.html'">
      <img src="${escolhido.imagem}" alt="${escolhido.nome}" loading="lazy">
      <div>
        <h3>${escolhido.nome}</h3>
        <p>${(escolhido.descricao || "").replaceAll("\n","<br>")}</p>
        <div class="mini">‚≠ê ${escolhido.nota || ""}</div>
      </div>
    </div>
  `;
}

// Busca inteligente (Home)
function setupBuscaHome(){
  const input = document.getElementById("buscaHome");
  const box = document.getElementById("sugestoes");
  if(!input || !box) return;

  function esconder(){ box.style.display = "none"; box.innerHTML = ""; }

  function mostrar(lista){
    if(!lista.length){ esconder(); return; }
    box.innerHTML = lista.map(d => `
      <div class="item" data-nome="${encodeURIComponent(d.nome)}">
        <img src="${d.imagem}" alt="${d.nome}">
        <div>
          <div class="nome">${d.nome}</div>
          <div class="nota">‚≠ê ${d.nota || ""}</div>
        </div>
      </div>
    `).join("");
    box.style.display = "block";
  }

  input.addEventListener("input", () => {
    const q = (input.value || "").toLowerCase().trim();
    if(q.length < 2) return esconder();

    const resultados = doramas
      .filter(d => (d.nome || "").toLowerCase().includes(q))
      .slice(0, 6);

    mostrar(resultados);
  });

  box.addEventListener("click", (e) => {
    const item = e.target.closest(".item");
    if(!item) return;
    const nome = decodeURIComponent(item.getAttribute("data-nome"));
    window.location.href = "/doramas/" + criarSlug(nome) + ".html";
  });

  document.addEventListener("click", (e) => {
    if(e.target === input || box.contains(e.target)) return;
    esconder();
  });

  input.addEventListener("keydown", (e) => {
    if(e.key === "Enter"){
      const q = (input.value || "").toLowerCase().trim();
      const primeiro = doramas.find(d => (d.nome || "").toLowerCase().includes(q));
      if(primeiro){
        window.location.href = "/doramas/" + criarSlug(primeiro.nome) + ".html";
      }
    }
  });
}

// Not√≠cias + Tradu√ß√£o
function limparHtml(texto) {
  return (texto || "").replace(/<[^>]*>?/gm, "").trim();
}
function formatarData(pubDate) {
  if (!pubDate) return "";
  const d = new Date(pubDate);
  if (isNaN(d.getTime())) return "";
  return d.toLocaleDateString("pt-BR", { day:"2-digit", month:"short", year:"numeric" });
}
function pegarImagemNoticia(item){
  if (item.thumbnail && item.thumbnail.startsWith("http")) return item.thumbnail;
  if (item.enclosure && item.enclosure.link && item.enclosure.link.startsWith("http")) return item.enclosure.link;
  const html = item.description || "";
  const match = html.match(/<img[^>]+src=["']([^"']+)["']/i);
  if (match && match[1] && match[1].startsWith("http")) return match[1];
  return "";
}

const CACHE_KEY = "trad_cache_home_v4";
const tradCache = JSON.parse(localStorage.getItem(CACHE_KEY) || "{}");
function salvarCache(){ localStorage.setItem(CACHE_KEY, JSON.stringify(tradCache)); }
const LT_ENDPOINT = "https://translate.argosopentech.com/translate";

async function traduzirParaPT(texto) {
  const t = (texto || "").trim();
  if (!t) return "";
  const curto = t.slice(0, 240);
  if (tradCache[curto]) return tradCache[curto];

  try{
    const resp = await fetch(LT_ENDPOINT, {
      method: "POST",
      headers: { "Content-Type":"application/json" },
      body: JSON.stringify({ q: curto, source:"en", target:"pt", format:"text" })
    });
    if (resp.ok) {
      const data = await resp.json();
      const out = (data.translatedText || curto).trim();
      tradCache[curto] = out; salvarCache();
      return out;
    }
  } catch(e){}

  try{
    const url = "https://api.mymemory.translated.net/get?q=" + encodeURIComponent(curto) + "&langpair=en|pt-BR";
    const resp2 = await fetch(url);
    const data2 = await resp2.json();
    const out2 = (data2.responseData && data2.responseData.translatedText) ? data2.responseData.translatedText.trim() : curto;
    tradCache[curto] = out2; salvarCache();
    return out2;
  } catch(e){}

  return curto;
}

async function carregarNoticiasAutomaticas(forcar=false) {
  const grid = document.getElementById("grid-noticias");
  grid.innerHTML = `
    <div class="noticia">
      <div class="conteudo">
        <h3>üì∞ Carregando not√≠cias...</h3>
        <p>Aguarde alguns segundos ‚ú®</p>
      </div>
    </div>
  `;

  try {
    const extra = forcar ? ("&cacheBust=" + Date.now()) : "";
    const feed = "https://blog.asianwiki.com/feed/";
    const url = "https://api.rss2json.com/v1/api.json?rss_url=" + encodeURIComponent(feed) + extra;

    const resp = await fetch(url);
    const data = await resp.json();
    if (!data.items || !Array.isArray(data.items)) throw new Error("Sem not√≠cias");

    const top = data.items.slice(0, 6);

    grid.innerHTML = top.map((n, idx) => {
      const img = pegarImagemNoticia(n);
      const descLimpo = limparHtml(n.description);
      const descCurto = descLimpo.slice(0, 160) + (descLimpo.length > 160 ? "..." : "");
      return `
        <div class="noticia" id="home_news_${idx}">
          ${img ? `<img class="img" src="${img}" alt="Not√≠cia">` : ``}
          <div class="conteudo">
            <h3 class="t">${n.title}</h3>
            <div class="meta">AsianWiki ‚Ä¢ ${formatarData(n.pubDate)}</div>
            <p class="d">${descCurto}</p>
            <p style="margin-top:10px;">
              <a href="${n.link}" target="_blank" rel="noopener noreferrer">Ler not√≠cia original ‚Üí</a>
            </p>
            <p class="trad" style="margin-top:10px; font-size:12px; opacity:0.75;">Traduzindo‚Ä¶</p>
          </div>
        </div>
      `;
    }).join("");

    top.forEach((n, idx) => {
      (async () => {
        const card = document.getElementById(`home_news_${idx}`);
        if (!card) return;

        const descLimpo = limparHtml(n.description);
        const descCurto = descLimpo.slice(0, 160) + (descLimpo.length > 160 ? "..." : "");

        const tituloPT = await traduzirParaPT(n.title);
        const descPT   = await traduzirParaPT(descCurto);

        card.querySelector(".t").innerText = tituloPT;
        card.querySelector(".d").innerText = descPT;

        const p = card.querySelector(".trad");
        if (p) p.remove();
      })();
    });

  } catch (e) {
    grid.innerHTML = `
      <div class="noticia">
        <div class="conteudo">
          <h3>üò¢ N√£o foi poss√≠vel carregar</h3>
          <p>Tente atualizar. Se persistir, pode ser limite do RSS2JSON ou da tradu√ß√£o.</p>
        </div>
      </div>
    `;
  }
}

// Init
window.onload = () => {
  carregarTop5();
  setupBuscaHome();
  carregarDoramaDaSemana();
  carregarNoticiasAutomaticas(false);
};
</script>

</body>
</html>
