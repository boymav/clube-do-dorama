<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dorama | Planeta Dorama üåç</title>
<link rel="stylesheet" href="style.css">

<style>
:root{
  --rosa:#ff7eb3;
  --roxo:#b983ff;
  --texto:#333;
  --muted:#666;
}

body{
  margin:0;
  font-family:'Segoe UI', sans-serif;
  background: linear-gradient(135deg, #ffe6f2, #fff0f7);
  color: var(--texto);
}

/* HEADER (se j√° tiver no style.css, pode remover daqui depois) */
header{
  text-align:center;
  padding:20px;
  background:linear-gradient(90deg,var(--rosa),var(--roxo));
  color:white;
}
header h1{ margin:0; }
header a{
  color:white;
  text-decoration:none;
  font-weight:bold;
  display:inline-block;
  margin-top:8px;
  opacity:0.95;
}

/* ===== HERO / BANNER ===== */
.hero{
  position: relative;
  max-width: 1100px;
  margin: 22px auto 0;
  border-radius: 22px;
  overflow: hidden;
  box-shadow: 0 16px 40px rgba(0,0,0,0.14);
}

/* Fundo com blur da pr√≥pria imagem */
.hero::before{
  content:"";
  position:absolute;
  inset:0;
  background-image: var(--hero-bg, linear-gradient(90deg, var(--rosa), var(--roxo)));
  background-size: cover;
  background-position: center;
  filter: blur(22px);
  transform: scale(1.15);
}

/* camada escura para o texto ficar leg√≠vel */
.hero::after{
  content:"";
  position:absolute;
  inset:0;
  background: linear-gradient(90deg,
    rgba(20, 0, 20, 0.75),
    rgba(20, 0, 20, 0.40),
    rgba(20, 0, 20, 0.10)
  );
}

.hero-inner{
  position: relative;
  z-index: 1;
  padding: 26px;
  display:grid;
  grid-template-columns: 300px 1fr;
  gap: 22px;
  align-items: center;
  color: #fff;
}

@media (max-width: 900px){
  .hero{ margin: 16px 14px 0; }
  .hero-inner{
    grid-template-columns: 1fr;
    padding: 18px;
    text-align:center;
  }
}

/* Poster dentro do banner (padr√£o sem cortar) */
.poster{
  width: 100%;
  max-width: 300px;
  aspect-ratio: 2 / 3;
  border-radius: 18px;
  overflow: hidden;
  background: rgba(255,255,255,0.08);
  box-shadow: 0 12px 30px rgba(0,0,0,0.28);
  margin: 0 auto;
  display:flex;
  align-items:center;
  justify-content:center;
}
.poster img{
  width:100%;
  height:100%;
  object-fit: contain; /* N√ÉO corta */
  object-position:center;
  display:block;
  background: rgba(255,255,255,0.06);
}

.hero-title{
  margin:0 0 10px;
  font-size: 34px;
  line-height: 1.15;
}
@media(max-width:900px){
  .hero-title{ font-size: 26px; }
}

.hero-meta{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  align-items:center;
  margin: 10px 0 12px;
  justify-content:flex-start;
}
@media(max-width:900px){
  .hero-meta{ justify-content:center; }
}

.chip{
  display:inline-block;
  padding: 8px 12px;
  border-radius: 999px;
  background: rgba(255,255,255,0.14);
  border: 1px solid rgba(255,255,255,0.18);
  font-weight: bold;
  font-size: 13px;
}

.tags{
  margin-top: 6px;
}
.tag{
  display:inline-block;
  padding: 7px 10px;
  border-radius: 999px;
  background: rgba(255,255,255,0.14);
  border: 1px solid rgba(255,255,255,0.18);
  margin: 6px 6px 0 0;
  font-weight: bold;
  font-size: 12px;
}

/* estrelas */
.stars{
  font-size: 18px;
  letter-spacing: 2px;
  margin-top: 2px;
}
.stars small{
  letter-spacing: 0;
  font-size: 13px;
  opacity: 0.9;
}

/* Bot√µes no hero */
.hero-actions{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin-top: 14px;
}
@media(max-width:900px){
  .hero-actions{ justify-content:center; }
}

.btn{
  padding: 12px 16px;
  border-radius: 14px;
  border:none;
  cursor:pointer;
  font-weight:bold;
  font-size: 15px;
  background: var(--rosa);
  color:#fff;
}
.btn:hover{ background: var(--roxo); }

.btn-sec{
  background: rgba(255,255,255,0.15);
  border: 1px solid rgba(255,255,255,0.20);
}
.btn-sec:hover{
  background: rgba(255,255,255,0.22);
}

/* ===== CONTE√öDO ===== */
#conteudo-detalhe{
  max-width: 980px;
  margin: 18px auto 50px;
  background: white;
  padding: 28px;
  border-radius: 20px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.10);
}

@media (max-width: 900px){
  #conteudo-detalhe{ margin: 16px 14px 40px; padding: 20px; }
}

/* texto */
.texto{
  font-size: 18px;
  line-height: 1.85;
  color: #444;
  text-align: justify;
  margin: 0;
}
@media(max-width:900px){ .texto{ font-size:16px; } }

.divisor{
  height:1px;
  background: rgba(0,0,0,0.08);
  margin: 18px 0;
}

/* Trailer responsivo */
.trailer-box{ margin-top: 14px; }
.trailer-box h3{
  font-size:22px;
  color:#d63384;
  margin: 0 0 10px;
}
.video-wrap{
  width: 100%;
  aspect-ratio: 16 / 9;
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 10px 26px rgba(0,0,0,0.12);
  background:#000;
}
.video-wrap iframe{
  width:100%;
  height:100%;
  border:0;
  display:block;
}

/* Relacionados */
.relacionados{
  margin-top: 26px;
  padding-top: 18px;
  border-top: 1px solid rgba(0,0,0,0.08);
}
.relacionados h3{
  margin: 0 0 12px;
  color:#d63384;
  font-size: 22px;
}
.cards-mini{
  display:flex;
  flex-wrap:wrap;
  gap: 14px;
}
.card-mini{
  width: 190px;
  background:#fff;
  border-radius: 16px;
  overflow:hidden;
  box-shadow: 0 6px 18px rgba(0,0,0,0.10);
  cursor:pointer;
  transition: transform .2s ease, box-shadow .2s ease;
}
.card-mini:hover{
  transform: translateY(-5px);
  box-shadow: 0 10px 26px rgba(0,0,0,0.14);
}
.card-mini img{
  width:100%;
  height:230px;
  object-fit: cover;
  display:block;
}
.card-mini .info{
  padding: 10px 10px 12px;
}
.card-mini .info strong{
  font-size: 14px;
  color:#333;
  display:block;
  margin-bottom:6px;
}
.card-mini .info span{
  font-size: 13px;
  opacity: .85;
}
</style>
</head>

<body>

<header>
  <h1>üåç Planeta Dorama</h1>
  <a href="index.html">‚¨Ö Voltar</a>
</header>

<!-- HERO (banner) -->
<section id="hero" class="hero" style="display:none;">
  <div class="hero-inner" id="hero-inner"></div>
</section>

<!-- Conte√∫do -->
<section id="conteudo-detalhe"></section>

<script src="script.js"></script>
<script src="doramas.js"></script>
<script>
const FAV_KEY = "pd_favoritos_v1";

function getFavoritos(){
  try { return JSON.parse(localStorage.getItem(FAV_KEY) || "[]"); }
  catch(e){ return []; }
}
function setFavoritos(lista){ localStorage.setItem(FAV_KEY, JSON.stringify(lista)); }
function isFav(nome){ return getFavoritos().includes(nome); }
function toggleFav(nome){
  const favs = getFavoritos();
  const idx = favs.indexOf(nome);
  if(idx >= 0) favs.splice(idx, 1);
  else favs.push(nome);
  setFavoritos(favs);
  return favs.includes(nome);
}

function escaparHtml(str){
  return (str || "").replace(/[&<>"']/g, m => ({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
  }[m]));
}

function parseNota(nota){
  const m = String(nota || "").match(/[\d]+([.,]\d+)?/);
  if(!m) return 0;
  return parseFloat(m[0].replace(",", "."));
}

/* Converte nota 0-10 para estrelas 0-5 (com meia estrela) */
function estrelasDeNota(notaStr){
  const n10 = parseNota(notaStr);        // 0..10
  const n5  = Math.max(0, Math.min(5, n10 / 2)); // 0..5
  const cheio = Math.floor(n5);
  const resto = n5 - cheio;
  const meio  = resto >= 0.5 ? 1 : 0;
  const vazio = 5 - cheio - meio;

  const stars = "‚òÖ".repeat(cheio) + (meio ? "‚òÜ" : "") + "‚ú©".repeat(vazio);
  // Usamos: ‚òÖ cheio, ‚òÜ meia (visual), ‚ú© vazio
  return { stars, n10: (isNaN(n10) ? "" : n10.toFixed(1).replace(".", ",")) };
}

function sugestoesRelacionadas(doramaAtual){
  const atualTags = Array.isArray(doramaAtual.tags) ? doramaAtual.tags : [];
  if(atualTags.length > 0){
    const similares = doramas
      .filter(d => d.nome !== doramaAtual.nome)
      .filter(d => Array.isArray(d.tags) && d.tags.some(t => atualTags.includes(t)));
    return similares.sort(() => 0.5 - Math.random()).slice(0, 6);
  }
  return doramas
    .filter(d => d.nome !== doramaAtual.nome)
    .sort(() => 0.5 - Math.random())
    .slice(0, 6);
}

function montarMetaLinha(d){
  const partes = [];
  if(d.ano) partes.push(String(d.ano));
  if(d.pais) partes.push(String(d.pais));
  if(d.episodios) partes.push(String(d.episodios) + " eps");
  return partes.join(" ‚Ä¢ ");
}

function carregarDorama(){
  const params = new URLSearchParams(window.location.search);
  const nome = params.get("nome");
  if(!nome) return;

  const dorama = doramas.find(d => d.nome === nome);
  if(!dorama) return;

  // imagem com fallback do trailer
  let imagemFinal = dorama.imagem;
  if(!imagemFinal && dorama.trailer){
    const videoId = dorama.trailer.split("/embed/")[1];
    if(videoId) imagemFinal = "https://img.youtube.com/vi/" + videoId + "/hqdefault.jpg";
  }

  const resumoFinal = (dorama.resumo || dorama.descricao || "").replaceAll("\n","<br>");
  const fav = isFav(dorama.nome);
  const starInfo = estrelasDeNota(dorama.nota);

  // tags
  const tagsHtml = Array.isArray(dorama.tags) && dorama.tags.length
    ? `<div class="tags">${dorama.tags.map(t => `<span class="tag">${escaparHtml(t)}</span>`).join("")}</div>`
    : "";

  // meta (ano/pais/episodios)
  const metaLinha = montarMetaLinha(dorama);
  const metaHtml = metaLinha ? `<span class="chip">üìå ${escaparHtml(metaLinha)}</span>` : "";

  // fundo blur no banner
  const hero = document.getElementById("hero");
  const heroInner = document.getElementById("hero-inner");
  hero.style.display = "block";
  hero.style.setProperty("--hero-bg", imagemFinal ? `url('${imagemFinal}')` : "linear-gradient(90deg, var(--rosa), var(--roxo))");

  heroInner.innerHTML = `
    <div>
      ${imagemFinal ? `
        <div class="poster">
          <img src="${imagemFinal}" alt="${escaparHtml(dorama.nome)}">
        </div>
      ` : ""}
    </div>

    <div>
      <h2 class="hero-title">${escaparHtml(dorama.nome)}</h2>

      <div class="hero-meta">
        ${metaHtml}
        <span class="chip">‚≠ê ${escaparHtml(dorama.nota || "")}</span>
        <span class="chip">
          <span class="stars">${starInfo.stars} <small>(${starInfo.n10})</small></span>
        </span>
      </div>

      ${tagsHtml}

      <div class="hero-actions">
        <button id="btnFav" class="btn">${fav ? "üíú Favoritado ‚úÖ" : "ü§ç Favoritar"}</button>
        ${dorama.trailer ? `<button id="btnTrailer" class="btn btn-sec">üé¨ Ver trailer</button>` : ""}
      </div>
    </div>
  `;

  // Conte√∫do principal
  const relacionados = sugestoesRelacionadas(dorama);
  const relacionadosHtml = relacionados.length ? `
    <div class="relacionados">
      <h3>‚ú® Doramas parecidos</h3>
      <div class="cards-mini">
        ${relacionados.map(d => `
          <div class="card-mini" onclick="window.location.href='dorama.html?nome=${encodeURIComponent(d.nome)}'">
            <img src="${d.imagem}" alt="${escaparHtml(d.nome)}" loading="lazy">
            <div class="info">
              <strong>${escaparHtml(d.nome)}</strong>
              <span>‚≠ê ${escaparHtml(d.nota || "")}</span>
            </div>
          </div>
        `).join("")}
      </div>
    </div>
  ` : "";

  document.getElementById("conteudo-detalhe").innerHTML = `
    <div class="divisor"></div>

    <p class="texto">${resumoFinal}</p>

    ${dorama.trailer ? `
      <div class="trailer-box" id="secTrailer">
        <h3>üé¨ Trailer</h3>
        <div class="video-wrap">
          <iframe src="${dorama.trailer}" allowfullscreen></iframe>
        </div>
      </div>
    ` : ""}

    ${relacionadosHtml}
  `;

  // eventos
  const btnFav = document.getElementById("btnFav");
  if(btnFav){
    btnFav.addEventListener("click", () => {
      const agoraFav = toggleFav(dorama.nome);
      btnFav.textContent = agoraFav ? "üíú Favoritado ‚úÖ" : "ü§ç Favoritar";
    });
  }

  const btnTrailer = document.getElementById("btnTrailer");
  if(btnTrailer){
    btnTrailer.addEventListener("click", () => {
      const alvo = document.getElementById("secTrailer");
      if(alvo) alvo.scrollIntoView({ behavior:"smooth", block:"start" });
    });
  }

  document.title = dorama.nome + " | Planeta Dorama üåç";
}

carregarDorama();
</script>

</body>
</html>
